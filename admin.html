<!doctype html>
<html lang="es" class="theme-light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Panel Administrativo - Cooperativa</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Tipografías Premium Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@600;700&family=Manrope:wght@500;600&display=swap" rel="stylesheet">
    <!-- Librerías para exportar PDF (sin backend) -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>
  <body>
    <main class="container admin">
      <header class="hero small">
        <div class="logo">
          <img id="adminLogoImg" src="./logodecoopatria.png" alt="Logo Cooperativa" style="width:48px;height:48px;object-fit:contain;border-radius:10px;" />
        </div>
  <!-- removed duplicate preview; header uses #adminLogoImg -->
        <div>
          <h1>Panel Administrativo</h1>
          <p class="lead">Listado de solicitudes guardadas en localStorage</p>
        </div>
        <div style="margin-left:auto;display:flex;align-items:center;gap:8px">
          <button id="openSettingsBtn" title="Configuración" class="btn" style="display:flex;align-items:center;gap:8px">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7zm7.94-2.06l1.06 1.84-2 3.46-2.28-.6a7.98 7.98 0 0 1-1.66.96l-.34 2.32h-4l-.34-2.32a7.98 7.98 0 0 1-1.66-.96l-2.28.6-2-3.46 1.06-1.84A7.95 7.95 0 0 1 2.06 12L1 10.16l2-3.46 2.28.6c.5-.36 1.03-.66 1.58-.9L7.2 3.08h4l.34 2.32c.55.24 1.08.54 1.58.9l2.28-.6 2 3.46-1.06 1.84c.3.63.52 1.3.7 2.0z" fill="currentColor"/></svg>
            <span style="font-size:13px">Tasa</span>
          </button>
        </div>
      </header>

      <section class="card admin-card">
        <div class="admin-actions">
          <button id="refreshBtn" class="btn">Refrescar</button>
          <button id="clearBtn" class="btn danger">Borrar todas (solo demo)</button>
        </div>

        <!-- Panel de configuración de tasa (oculto inicialmente) -->
        <div id="settingsPanel" class="card" style="margin-top:16px;display:none">
          <h3>Configuración de Tasa de Interés</h3>
          <div style="display:flex;gap:12px;align-items:center;margin-top:10px;flex-wrap:wrap">
            <label for="interestRateInput" style="min-width:160px">Tasa Anual (%)</label>
            <input id="interestRateInput" type="number" min="0" step="0.01" placeholder="18" style="padding:8px;border-radius:8px;border:1px solid var(--input-border)" />
            <button id="saveInterestBtn" class="btn btn-primary">Guardar</button>
            <button id="closeSettingsBtn" class="btn">Cerrar</button>
          </div>
          <small style="display:block;margin-top:8px;color:var(--text-muted)">La tasa guardada se usará para calcular la cuota mensual en el formulario público.</small>
        </div>

        <div class="filter-bar">
          <div class="filter-group">
            <label for="filterName">Buscar por nombre</label>
            <input type="text" id="filterName" placeholder="Nombre o apellido" />
          </div>
          <div class="filter-group">
            <label for="filterDateFrom">Desde (fecha)</label>
            <input type="date" id="filterDateFrom" />
          </div>
          <div class="filter-group">
            <label for="filterDateTo">Hasta (fecha)</label>
            <input type="date" id="filterDateTo" />
          </div>
          <div class="filter-group">
            <label for="filterStatus">Estado</label>
            <select id="filterStatus">
              <option value="">Todos</option>
              <option value="Pendiente">Pendiente</option>
              <option value="Aprobado">Aprobado</option>
              <option value="Rechazado">Rechazado</option>
            </select>
          </div>
        </div>

        <div id="listContainer" class="list-container">
          <!-- Aquí se renderizan las solicitudes -->
        </div>
      </section>

      <footer class="footer">
        <small>ESTO PASARA AL COMITE DE CREDITO CUANDO SEA APROBADO SE ESTARA LLAMANDO</small>
      </footer>
    </main>

    <!-- Modal de detalles -->
    <div id="detailModal" class="modal hidden" aria-hidden>
      <div class="modal-content">
        <button class="modal-close" id="closeModal">×</button>
        <div id="detailArea"></div>
      </div>
    </div>
    <script>
      // Sincronizar logo header y preview desde localStorage (coop_logo)
      (function(){
        try{
          const data = localStorage.getItem('coop_logo');
          const adminImg = document.getElementById('adminLogoImg');
          const preview = document.getElementById('logoPreview');
          const fallback = './logodecoopatria.png';
          if(data && (adminImg || preview)){
            if(adminImg) { adminImg.src = data; }
            if(preview) { preview.src = data; }
            return;
          }
          // Intentar fichero por defecto
          const test = new Image();
          test.onload = function(){ if(adminImg) adminImg.src = fallback; if(preview) preview.src = fallback; };
          test.onerror = function(){ /* dejar lo que haya por defecto */ };
          test.src = fallback;
        }catch(e){/* ignore */}
      })();
    </script>
    <script src="admin.js" defer></script>
  </body>
</html>
